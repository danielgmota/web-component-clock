<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relogio</title>
  </head>
  <body>
    <template id="tpl-relogio">
      <style>
        :host {
          display: inline-block;
        }
      </style>
      <svg width="100" height="100">
        <g transform="translate(50,50)">
          <circle
            cx="0"
            cy="0"
            r="45"
            fill="none"
            stroke="black"
            stroke-width="2"
          />
          <path
            id="seconds"
            transform="rotate(35)"
            d="M 0 0 V 0 -40"
            fill="none"
            stroke="black"
            stroke-width="1"
          />
          <path
            id="hour"
            transform="rotate(110)"
            d="M 0 0 V 0 -40"
            fill="none"
            stroke="black"
            stroke-width="3"
          />
          <path
            id="minutes"
            transform="rotate(70)"
            d="M 0 0 V 0 -40"
            fill="none"
            stroke="red"
            stroke-width="2"
          />

          <g id="pointers" fill="none" stroke="black" stroke-width="2">
            <path d="M 0 -40 V -45" transform="rotate(0)" />
            <path d="M 0 -40 V -45" transform="rotate(30)" />
            <path d="M 0 -40 V -45" transform="rotate(-30)" />
            <path d="M 0 -40 V -45" transform="rotate(60)" />
            <path d="M 0 -40 V -45" transform="rotate(-60)" />
            <path d="M 0 -40 V -45" transform="rotate(90)" />
            <path d="M 0 -40 V -45" transform="rotate(-90)" />
            <path d="M 0 -40 V -45" transform="rotate(120)" />
            <path d="M 0 -40 V -45" transform="rotate(-120)" />
            <path d="M 0 -40 V -45" transform="rotate(150)" />
            <path d="M 0 -40 V -45" transform="rotate(-150)" />
            <path d="M 0 -40 V -45" transform="rotate(180)" />
          </g>
        </g>
      </svg>
    </template>

    <wc-relogio tipo="digital"></wc-relogio>

    <script>
      class WcRelogio extends HTMLElement {
        // static observedAttributes = ["value"];

        constructor() {
          super();
          this.attachShadow({
            mode: "open",
          });

          this.digitalClock = document.createElement("span");
          this.digitalClock.textContent = getHMS();

          const type = this.getAttribute("tipo");
          const tpl = document.getElementById("tpl-relogio");

          type === "analogico"
            ? this.shadowRoot.append(tpl.content.cloneNode(true))
            : this.shadowRoot.append(this.digitalClock);
        }

        connectedCallback() {
          this.digitalClock.textContent = getHMS();
          this.timer = setInterval(() => {
            this.digitalClock.textContent = getHMS();
          }, 1000);
        }

        disconnectedCallback() {
          clearInterval(this.timer);
        }
      }

      const getHMS = () => {
        const dh = new Date();
        const h = formatNumber(dh.getHours());
        const m = formatNumber(dh.getMinutes());
        const s = formatNumber(dh.getSeconds());
        return `${h}:${m}:${s}`;
      };

      const formatNumber = (n) => {
        return String(n).padStart(2, "0");
      };

      customElements.define("wc-relogio", WcRelogio);
    </script>
  </body>
</html>
